Скрипт: CertificateInjector.ps1

Назначение: 

	- извлечение ссылок на корневые сертификаты удостоверяющих центров и списков отзывов из файлов сертификатов клиентов;
    - загрузка корневых сертификатов удостоверяющих центров и списков отзывов;
    - установка корневых сертификатов удостоверяющих центров и списков отзывов;
	
Авторы:

	- Pan_2
	- Miller77
	
Технология: PowerShell

Принцип работы:

Скрипт извлекает из сертификата пользователя ссылки на загрузку корневых сертификатов удостоверяющих центров и списков отзывов, скачивает их в отдельную папку и устанавливает:

- списки отзыва - по умолчанию;
- корневые сертификаты - в хранилище локального компьютера в доверенные корневые центры (== Registry);

Имеющиеся ограничения:

- должно быть разрешено выполнение скриптов PowerShell. По умолчанию оно отключено из соображений безопасности. Для разрешения запустить Enable_PowerShell.cmd с правами администратора.

- скрипту для работы требуются права администратора. Если их нет - он их запросит.

- для загрузки сертификатов используется служба BITS. Ее запуск должен быть разрешен. Если этот пункт будет вызывать проблемы, есть альтернативные варианты загрузки, можно переписать. Но, по идее, проблем быть не должно - срипт сам изменит параметр ее запуска на "Automatic" и попытается запустить;

- для установки списков отзывов вызывается утилита certutil.exe, но она, насколько я понимаю, является частью Windows и есть  в любых весиях.

- на Windows XP, в теории, может заработать, - после установки .Net Framework 3.5, 4.0 и, собственно, PowerShell. Слишком много зависимостей придется ставить, а результат под вопросом. Да и современные криптопровайдеры официально Windows XP уже не поддерживают. Так что этот пункт проходит по разделу "курьезы". На Windows 7, возможно, потребуется обновить PowerShell. У меня работает, но у меня он обновлен.

- сообщение о завершении работы скрипта само по себе не означает успешного импорта сертификатов. Необходимо убедиться в выполненном импорте с помощью стандартной оснастки certmgr.msc. Возможно, когда-нибудь будет доработано, добавлю проверку.

Тестировалось на: 

- Windows 7x64;
- Windows 10x64;

Использование:

- сохранить сертификат пользователя в любую папку;
- запустить скрипт, лучше от имени администратора; если скрипт не запускается двойным кликом по нему, кликнуть на нем правой кнопкой мыши и выбрать "Выполнить с помощью PowerShell";
- в открывшемся окне выбрать данную папку;
- в данной папке будет создана подпапка CRT_CRL_Downloads, где будут лежать скачанные корневые сертификаты и списки отзывов;
- по завершении работы скрипт выдаст сообщение об этом в области уведомлений и закроется;